/*
JqTree 1.7.4

Copyright 2023 Marco Braak

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
@license

*/
var jqtree=function(e){"use strict";let t=function(e){return e[e.Before=1]="Before",e[e.After=2]="After",e[e.Inside=3]="Inside",e[e.None=4]="None",e}({});const s={before:t.Before,after:t.After,inside:t.Inside,none:t.None},o=e=>{for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&s[t]===e)return t;return""},i=e=>"object"==typeof e&&"children"in e&&e.children instanceof Array;class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;this.name="",this.isEmptyFolder=!1,this.load_on_demand=!1,this.setData(e),this.children=[],this.parent=null,t&&(this.idMapping=new Map,this.tree=this,this.nodeClass=s)}setData(e){if(e)if("string"==typeof e)this.name=e;else if("object"==typeof e)for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const s=e[t];"label"===t||"name"===t?"string"==typeof s&&(this.name=s):"children"!==t&&"parent"!==t&&(this[t]=s)}}loadFromData(e){this.removeChildren();for(const t of e){const e=this.createNode(t);this.addChild(e),i(t)&&(0===t.children.length?e.isEmptyFolder=!0:e.loadFromData(t.children))}return this}addChild(e){this.children.push(e),e.setParent(this)}addChildAtPosition(e,t){this.children.splice(t,0,e),e.setParent(this)}removeChild(e){e.removeChildren(),this.doRemoveChild(e)}getChildIndex(e){return this.children.indexOf(e)}hasChildren(){return 0!==this.children.length}isFolder(){return this.hasChildren()||this.load_on_demand}iterate(e){const t=(s,o)=>{if(s.children)for(const i of s.children){e(i,o)&&i.hasChildren()&&t(i,o+1)}};t(this,0)}moveNode(e,s,o){if(!e.parent||e.isParentOf(s))return!1;switch(e.parent.doRemoveChild(e),o){case t.After:return!!s.parent&&(s.parent.addChildAtPosition(e,s.parent.getChildIndex(s)+1),!0);case t.Before:return!!s.parent&&(s.parent.addChildAtPosition(e,s.parent.getChildIndex(s)),!0);case t.Inside:return s.addChildAtPosition(e,0),!0;default:return!1}}getData(){const e=t=>t.map((t=>{const s={};for(const e in t)if(-1===["parent","children","element","idMapping","load_on_demand","nodeClass","tree","isEmptyFolder"].indexOf(e)&&Object.prototype.hasOwnProperty.call(t,e)){const o=t[e];s[e]=o}return t.hasChildren()&&(s.children=e(t.children)),s}));return e(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?[this]:this.children)}getNodeByName(e){return this.getNodeByCallback((t=>t.name===e))}getNodeByNameMustExist(e){const t=this.getNodeByCallback((t=>t.name===e));if(!t)throw`Node with name ${e} not found`;return t}getNodeByCallback(e){let t=null;return this.iterate((s=>!t&&(!e(s)||(t=s,!1)))),t}addAfter(e){if(this.parent){const t=this.createNode(e),s=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,s+1),i(e)&&e.children.length&&t.loadFromData(e.children),t}return null}addBefore(e){if(this.parent){const t=this.createNode(e),s=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,s),i(e)&&e.children.length&&t.loadFromData(e.children),t}return null}addParent(e){if(this.parent){const t=this.createNode(e);this.tree&&t.setParent(this.tree);const s=this.parent;for(const e of s.children)t.addChild(e);return s.children=[],s.addChild(t),t}return null}remove(){this.parent&&(this.parent.removeChild(this),this.parent=null)}append(e){const t=this.createNode(e);return this.addChild(t),i(e)&&e.children.length&&t.loadFromData(e.children),t}prepend(e){const t=this.createNode(e);return this.addChildAtPosition(t,0),i(e)&&e.children.length&&t.loadFromData(e.children),t}isParentOf(e){let t=e.parent;for(;t;){if(t===this)return!0;t=t.parent}return!1}getLevel(){let e=0,t=this;for(;t.parent;)e+=1,t=t.parent;return e}getNodeById(e){return this.idMapping.get(e)||null}addNodeToIndex(e){null!=e.id&&this.idMapping.set(e.id,e)}removeNodeFromIndex(e){null!=e.id&&this.idMapping.delete(e.id)}removeChildren(){this.iterate((e=>(this.tree?.removeNodeFromIndex(e),!0))),this.children=[]}getPreviousSibling(){if(this.parent){const e=this.parent.getChildIndex(this)-1;return e>=0&&this.parent.children[e]||null}return null}getNextSibling(){if(this.parent){const e=this.parent.getChildIndex(this)+1;return e<this.parent.children.length&&this.parent.children[e]||null}return null}getNodesByProperty(e,t){return this.filter((s=>s[e]===t))}filter(e){const t=[];return this.iterate((s=>(e(s)&&t.push(s),!0))),t}getNextNode(){if((!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.hasChildren())return this.children[0]||null;if(this.parent){const e=this.getNextSibling();return e||this.parent.getNextNode(!1)}return null}getNextVisibleNode(){if(this.hasChildren()&&this.is_open)return this.children[0]||null;if(this.parent){const e=this.getNextSibling();return e||this.parent.getNextNode(!1)}return null}getPreviousNode(){if(this.parent){const e=this.getPreviousSibling();return e?e.hasChildren()?e.getLastChild():e:this.getParent()}return null}getPreviousVisibleNode(){if(this.parent){const e=this.getPreviousSibling();return e?e.hasChildren()&&e.is_open?e.getLastChild():e:this.getParent()}return null}getParent(){return this.parent&&this.parent.parent?this.parent:null}getLastChild(){if(this.hasChildren()){const e=this.children[this.children.length-1];return e?e.hasChildren()&&e.is_open?e?.getLastChild():e:null}return null}initFromData(e){const t=e=>{for(const t of e){const e=this.createNode();e.initFromData(t),this.addChild(e)}};(e=>{this.setData(e),i(e)&&e.children.length&&t(e.children)})(e)}setParent(e){this.parent=e,this.tree=e.tree,this.tree?.addNodeToIndex(this)}doRemoveChild(e){this.children.splice(this.getChildIndex(e),1),this.tree?.removeNodeFromIndex(e)}getNodeClass(){return this.nodeClass||this?.tree?.nodeClass||n}createNode(e){return new(this.getNodeClass())(e)}}class r{constructor(e){this.treeWidget=e,this.hoveredArea=null,this.hitAreas=[],this.isDragging=!1,this.currentItem=null,this.positionInfo=null}mouseCapture(e){const t=jQuery(e.target);if(!this.mustCaptureElement(t))return null;if(this.treeWidget.options.onIsMoveHandle&&!this.treeWidget.options.onIsMoveHandle(t))return null;let s=this.treeWidget._getNodeElement(t);return s&&this.treeWidget.options.onCanMove&&(this.treeWidget.options.onCanMove(s.node)||(s=null)),this.currentItem=s,null!=this.currentItem}mouseStart(e){if(!this.currentItem||void 0===e.pageX||void 0===e.pageY)return!1;this.refresh();const t=jQuery(e.target).offset(),s=t?t.left:0,o=t?t.top:0,i=this.currentItem.node;return this.dragElement=new a(i.name,e.pageX-s,e.pageY-o,this.treeWidget.element,this.treeWidget.options.autoEscape??!0),this.isDragging=!0,this.positionInfo=e,this.currentItem.$element.addClass("jqtree-moving"),!0}mouseDrag(e){if(!this.currentItem||!this.dragElement||void 0===e.pageX||void 0===e.pageY)return!1;this.dragElement.move(e.pageX,e.pageY),this.positionInfo=e;const t=this.findHoveredArea(e.pageX,e.pageY);return t&&this.canMoveToArea(t)?(t.node.isFolder()||this.stopOpenFolderTimer(),this.hoveredArea!==t&&(this.hoveredArea=t,this.mustOpenFolderTimer(t)?this.startOpenFolderTimer(t.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeDropHint(),this.stopOpenFolderTimer(),this.hoveredArea=t),t||this.treeWidget.options.onDragMove&&this.treeWidget.options.onDragMove(this.currentItem.node,e.originalEvent),!0}mouseStop(e){this.moveItem(e),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas();const t=this.currentItem;return this.currentItem&&(this.currentItem.$element.removeClass("jqtree-moving"),this.currentItem=null),this.isDragging=!1,this.positionInfo=null,!this.hoveredArea&&t&&this.treeWidget.options.onDragStop&&this.treeWidget.options.onDragStop(t.node,e.originalEvent),!1}refresh(){this.removeHitAreas(),this.currentItem&&(this.generateHitAreas(),this.currentItem=this.treeWidget._getNodeElementForNode(this.currentItem.node),this.isDragging&&this.currentItem.$element.addClass("jqtree-moving"))}generateHitAreas(){if(this.currentItem){const e=new d(this.treeWidget.tree,this.currentItem.node,this.getTreeDimensions().bottom);this.hitAreas=e.generate()}else this.hitAreas=[]}mustCaptureElement(e){return!e.is("input,select,textarea")}canMoveToArea(e){if(!this.treeWidget.options.onCanMoveTo)return!0;if(!this.currentItem)return!1;const t=o(e.position);return this.treeWidget.options.onCanMoveTo(this.currentItem.node,e.node,t)}removeHitAreas(){this.hitAreas=[]}clear(){this.dragElement&&(this.dragElement.remove(),this.dragElement=null)}removeDropHint(){this.previousGhost&&this.previousGhost.remove()}removeHover(){this.hoveredArea=null}findHoveredArea(e,t){const s=this.getTreeDimensions();if(e<s.left||t<s.top||e>s.right||t>s.bottom)return null;let o=0,i=this.hitAreas.length;for(;o<i;){const e=o+i>>1,s=this.hitAreas[e];if(!s)return null;if(t<s.top)i=e;else{if(!(t>s.bottom))return s;o=e+1}}return null}mustOpenFolderTimer(e){const s=e.node;return s.isFolder()&&!s.is_open&&e.position===t.Inside}updateDropHint(){if(!this.hoveredArea)return;this.removeDropHint();const e=this.treeWidget._getNodeElementForNode(this.hoveredArea.node);this.previousGhost=e.addDropHint(this.hoveredArea.position)}startOpenFolderTimer(e){const t=()=>{this.treeWidget._openNode(e,this.treeWidget.options.slide,(()=>{this.refresh(),this.updateDropHint()}))};this.stopOpenFolderTimer();const s=this.treeWidget.options.openFolderDelay;!1!==s&&(this.openFolderTimer=window.setTimeout(t,s))}stopOpenFolderTimer(){this.openFolderTimer&&(clearTimeout(this.openFolderTimer),this.openFolderTimer=null)}moveItem(e){if(this.currentItem&&this.hoveredArea&&this.hoveredArea.position!==t.None&&this.canMoveToArea(this.hoveredArea)){const s=this.currentItem.node,i=this.hoveredArea.node,n=this.hoveredArea.position,r=s.parent;n===t.Inside&&(this.hoveredArea.node.is_open=!0);const l=()=>{this.treeWidget.tree.moveNode(s,i,n),this.treeWidget.element.empty(),this.treeWidget._refreshElements(null)};this.treeWidget._triggerEvent("tree.move",{move_info:{moved_node:s,target_node:i,position:o(n),previous_parent:r,do_move:l,original_event:e.originalEvent}}).isDefaultPrevented()||l()}}getTreeDimensions(){const e=this.treeWidget.element.offset();if(e){const t=this.treeWidget.element,s=t.width()||0,o=t.height()||0,i=e.left+this.treeWidget._getScrollLeft();return{left:i,top:e.top,right:i+s,bottom:e.top+o+16}}return{left:0,top:0,right:0,bottom:0}}}class l{constructor(e){this.tree=e}iterate(){let e=!0;const t=(s,o)=>{let i=(s.is_open||!s.element)&&s.hasChildren(),n=null;if(s.element){if(n=jQuery(s.element),!n.is(":visible"))return;e&&(this.handleFirstNode(s),e=!1),s.hasChildren()?s.is_open?this.handleOpenFolder(s,n)||(i=!1):this.handleClosedFolder(s,o,n):this.handleNode(s,o,n)}if(i){const e=s.children.length;s.children.forEach(((o,i)=>{const n=s.children[i];if(n)if(i===e-1)t(n,null);else{const e=s.children[i+1];e&&t(n,e)}})),s.is_open&&n&&this.handleAfterOpenFolder(s,o)}};t(this.tree,null)}}class d extends l{constructor(e,t,s){super(e),this.currentNode=t,this.treeBottom=s}generate(){return this.positions=[],this.lastTop=0,this.iterate(),this.generateHitAreas(this.positions)}generateHitAreas(e){let t=-1,s=[];const o=[];for(const i of e)i.top!==t&&s.length&&(s.length&&this.generateHitAreasForGroup(o,s,t,i.top),t=i.top,s=[]),s.push(i);return this.generateHitAreasForGroup(o,s,t,this.treeBottom),o}handleOpenFolder(e,s){if(e===this.currentNode){const o=this.getTop(s),i=s.height()||0;return this.addPosition(e,t.None,o),i>5&&this.addPosition(e,t.None,o+i-5),!1}return e.children[0]!==this.currentNode&&this.addPosition(e,t.Inside,this.getTop(s)),!0}handleClosedFolder(e,s,o){const i=this.getTop(o);e===this.currentNode?this.addPosition(e,t.None,i):(this.addPosition(e,t.Inside,i),s!==this.currentNode&&this.addPosition(e,t.After,i))}handleFirstNode(e){e!==this.currentNode&&this.addPosition(e,t.Before,this.getTop(jQuery(e.element)))}handleAfterOpenFolder(e,s){e===this.currentNode||s===this.currentNode?this.addPosition(e,t.None,this.lastTop):this.addPosition(e,t.After,this.lastTop)}handleNode(e,s,o){const i=this.getTop(o);e===this.currentNode?this.addPosition(e,t.None,i):this.addPosition(e,t.Inside,i),s===this.currentNode||e===this.currentNode?this.addPosition(e,t.None,i):this.addPosition(e,t.After,i)}getTop(e){const t=e.offset();return t?t.top:0}addPosition(e,t,s){const o={top:s,bottom:0,node:e,position:t};this.positions.push(o),this.lastTop=s}generateHitAreasForGroup(e,s,o,i){const n=Math.min(s.length,4),r=Math.round((i-o)/n);let l=o,d=0;for(;d<n;){const o=s[d];o&&o.position!==t.None&&e.push({top:l,bottom:l+r,node:o.node,position:o.position}),l+=r,d+=1}}}class a{constructor(e,t,s,o,i){this.offsetX=t,this.offsetY=s,this.$element=jQuery("<span>").addClass("jqtree-title jqtree-dragging"),i?this.$element.text(e):this.$element.html(e),this.$element.css("position","absolute"),o.append(this.$element)}move(e,t){this.$element.offset({left:e-this.offsetX,top:t-this.offsetY})}remove(){this.$element.remove()}}const h=e=>e?"true":"false";class c{constructor(e){this.treeWidget=e,this.openedIconElement=this.createButtonElement(e.options.openedIcon||"+"),this.closedIconElement=this.createButtonElement(e.options.closedIcon||"-")}render(e){e&&e.parent?this.renderFromNode(e):this.renderFromRoot()}renderFromRoot(){const e=this.treeWidget.element;e.empty(),e[0]&&this.createDomElements(e[0],this.treeWidget.tree.children,!0,1)}renderFromNode(e){const t=jQuery(e.element),s=this.createLi(e,e.getLevel());this.attachNodeData(e,s),t.after(s),t.remove(),e.children&&this.createDomElements(s,e.children,!1,e.getLevel()+1)}createDomElements(e,t,s,o){const i=this.createUl(s);e.appendChild(i);for(const e of t){const t=this.createLi(e,o);i.appendChild(t),this.attachNodeData(e,t),e.hasChildren()&&this.createDomElements(t,e.children,!1,o+1)}}attachNodeData(e,t){e.element=t,jQuery(t).data("node",e)}createUl(e){let t,s;e?(t="jqtree-tree",s="tree",this.treeWidget.options.rtl&&(t+=" jqtree-rtl")):(t="",s="group"),this.treeWidget.options.dragAndDrop&&(t+=" jqtree-dnd");const o=document.createElement("ul");return o.className=`jqtree_common ${t}`,o.setAttribute("role",s),o}createLi(e,t){const s=Boolean(this.treeWidget.selectNodeHandler.isNodeSelected(e)),o=e.isFolder()||e.isEmptyFolder&&this.treeWidget.options.showEmptyFolder?this.createFolderLi(e,t,s):this.createNodeLi(e,t,s);return this.treeWidget.options.onCreateLi&&this.treeWidget.options.onCreateLi(e,jQuery(o),s),o}setTreeItemAriaAttributes(e,t,s,o){e.setAttribute("aria-label",t),e.setAttribute("aria-level",`${s}`),e.setAttribute("aria-selected",h(o)),e.setAttribute("role","treeitem")}createFolderLi(e,t,s){const o=this.getButtonClasses(e),i=this.getFolderClasses(e,s),n=e.is_open?this.openedIconElement:this.closedIconElement,r=document.createElement("li");r.className=`jqtree_common ${i}`,r.setAttribute("role","none");const l=document.createElement("div");l.className="jqtree-element jqtree_common",l.setAttribute("role","none"),r.appendChild(l);const d=document.createElement("a");d.className=o,n&&d.appendChild(n.cloneNode(!0)),this.treeWidget.options.buttonLeft&&l.appendChild(d);const a=this.createTitleSpan(e.name,s,!0,t);return a.setAttribute("aria-expanded",h(e.is_open)),l.appendChild(a),this.treeWidget.options.buttonLeft||l.appendChild(d),r}createNodeLi(e,t,s){const o=["jqtree_common"];s&&o.push("jqtree-selected");const i=o.join(" "),n=document.createElement("li");n.className=i,n.setAttribute("role","none");const r=document.createElement("div");r.className="jqtree-element jqtree_common",r.setAttribute("role","none"),n.appendChild(r);const l=this.createTitleSpan(e.name,s,!1,t);return r.appendChild(l),n}createTitleSpan(e,t,s,o){const i=document.createElement("span");let n="jqtree-title jqtree_common";if(s&&(n+=" jqtree-title-folder"),n+=" jqtree-title-button-"+(this.treeWidget.options.buttonLeft?"left":"right"),i.className=n,t){const e=this.treeWidget.options.tabIndex;void 0!==e&&i.setAttribute("tabindex",`${e}`)}return this.setTreeItemAriaAttributes(i,e,o,t),this.treeWidget.options.autoEscape?i.textContent=e:i.innerHTML=e,i}getButtonClasses(e){const t=["jqtree-toggler","jqtree_common"];return e.is_open||t.push("jqtree-closed"),this.treeWidget.options.buttonLeft?t.push("jqtree-toggler-left"):t.push("jqtree-toggler-right"),t.join(" ")}getFolderClasses(e,t){const s=["jqtree-folder"];return e.is_open||s.push("jqtree-closed"),t&&s.push("jqtree-selected"),e.is_loading&&s.push("jqtree-loading"),s.join(" ")}createButtonElement(e){if("string"==typeof e){const t=document.createElement("div");return t.innerHTML=e,document.createTextNode(t.innerHTML)}return jQuery(e)[0]}}class u{constructor(e){this.treeWidget=e}loadFromUrl(e,t,s){if(!e)return;const o=this.getDomElement(t);this.addLoadingClass(o),this.notifyLoading(!0,t,o);const i=()=>{this.removeLoadingClass(o),this.notifyLoading(!1,t,o)};this.submitRequest(e,(e=>{i(),this.treeWidget.loadData(this.parseData(e),t),s&&"function"==typeof s&&s()}),(e=>{i(),this.treeWidget.options.onLoadFailed&&this.treeWidget.options.onLoadFailed(e)}))}addLoadingClass(e){e&&e.addClass("jqtree-loading")}removeLoadingClass(e){e&&e.removeClass("jqtree-loading")}getDomElement(e){return e?jQuery(e.element):this.treeWidget.element}notifyLoading(e,t,s){this.treeWidget.options.onLoading&&this.treeWidget.options.onLoading(e,t,s),this.treeWidget._triggerEvent("tree.loading_data",{isLoading:e,node:t,$el:s})}submitRequest(e,t,s){const o={method:"GET",cache:!1,dataType:"json",success:t,error:s,..."string"==typeof e?{url:e}:e};o.method=o.method?.toUpperCase()||"GET",jQuery.ajax(o)}parseData(e){const{dataFilter:t}=this.treeWidget.options,s="string"==typeof e?JSON.parse(e):e;return t?t(s):s}}class g{static LEFT=37;static UP=38;static RIGHT=39;static DOWN=40;constructor(e){this.treeWidget=e,e.options.keyboardSupport&&jQuery(document).on("keydown.jqtree",this.handleKeyDown)}deinit(){jQuery(document).off("keydown.jqtree")}moveDown(e){return this.selectNode(e.getNextVisibleNode())}moveUp(e){return this.selectNode(e.getPreviousVisibleNode())}moveRight(e){return!e.isFolder()||(e.is_open?this.selectNode(e.getNextVisibleNode()):(this.treeWidget.openNode(e),!1))}moveLeft(e){return e.isFolder()&&e.is_open?(this.treeWidget.closeNode(e),!1):this.selectNode(e.getParent())}selectNode(e){return!e||(this.treeWidget.selectNode(e),this.treeWidget.scrollHandler.isScrolledIntoView(jQuery(e.element).find(".jqtree-element"))||this.treeWidget.scrollToNode(e),!1)}handleKeyDown=e=>{if(!this.canHandleKeyboard())return!0;const t=this.treeWidget.getSelectedNode();if(!t)return!0;switch(e.which){case g.DOWN:return this.moveDown(t);case g.UP:return this.moveUp(t);case g.RIGHT:return this.moveRight(t);case g.LEFT:return this.moveLeft(t);default:return!0}};canHandleKeyboard(){return!!this.treeWidget.options.keyboardSupport&&this.treeWidget.selectNodeHandler.isFocusOnTree()}}const p=(e,t)=>{const s=()=>`simple_widget_${t}`,o=(e,t)=>{const s=jQuery.data(e,t);return s&&s instanceof m?s:null},i=(t,i)=>{const n=s();for(const s of t.get()){if(!o(s,n)){const t=new e(s,i);jQuery.data(s,n)||jQuery.data(s,n,t),t.init()}}return t};jQuery.fn[t]=function(t){if(!t)return i(this,null);if("object"==typeof t){return i(this,t)}if("string"==typeof t&&"_"!==t[0]){const i=t;if("destroy"===i)return(e=>{const t=s();for(const s of e.get()){const e=o(s,t);e&&e.destroy(),jQuery.removeData(s,t)}})(this);if("get_widget_class"===i)return e;for(var n=arguments.length,r=new Array(n>1?n-1:0),l=1;l<n;l++)r[l-1]=arguments[l];return((e,t,o)=>{let i=null;for(const n of e.get()){const e=jQuery.data(n,s());if(e&&e instanceof m){const s=e[t];s&&"function"==typeof s&&(i=s.apply(e,o))}}return i})(this,i,r)}}};class m{static register(e,t){p(e,t)}static defaults={};constructor(e,t){this.$el=jQuery(e);const s=this.constructor.defaults;this.options={...s,...t}}destroy(){this.deinit()}init(){}deinit(){}}const f=e=>({pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:e}),v=(e,t)=>({pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:t});class N extends m{init(){const e=this.$el.get(0);e&&(e.addEventListener("mousedown",this.mouseDown,{passive:!1}),e.addEventListener("touchstart",this.touchStart,{passive:!1})),this.isMouseStarted=!1,this.mouseDelayTimer=null,this.isMouseDelayMet=!1,this.mouseDownInfo=null}deinit(){const e=this.$el.get(0);e&&(e.removeEventListener("mousedown",this.mouseDown,{passive:!1}),e.removeEventListener("touchstart",this.touchStart,{passive:!1})),this.removeMouseMoveEventListeners()}mouseDown=e=>{if(0!==e.button)return;this.handleMouseDown(f(e))&&e.cancelable&&e.preventDefault()};handleMouseDown(e){return this.isMouseStarted&&this.handleMouseUp(e),this.mouseDownInfo=e,!!this.mouseCapture(e)&&(this.handleStartMouse(),!0)}handleStartMouse(){document.addEventListener("mousemove",this.mouseMove,{passive:!1}),document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("mouseup",this.mouseUp,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1});const e=this.getMouseDelay();e?this.startMouseDelayTimer(e):this.isMouseDelayMet=!0}startMouseDelayTimer(e){this.mouseDelayTimer&&clearTimeout(this.mouseDelayTimer),this.mouseDelayTimer=window.setTimeout((()=>{this.mouseDownInfo&&(this.isMouseDelayMet=!0)}),e),this.isMouseDelayMet=!1}mouseMove=e=>{this.handleMouseMove(e,f(e))};handleMouseMove(e,t){if(this.isMouseStarted)return this.mouseDrag(t),void(e.cancelable&&e.preventDefault());this.isMouseDelayMet&&(this.mouseDownInfo&&(this.isMouseStarted=!1!==this.mouseStart(this.mouseDownInfo)),this.isMouseStarted?(this.mouseDrag(t),e.cancelable&&e.preventDefault()):this.handleMouseUp(t))}mouseUp=e=>{this.handleMouseUp(f(e))};handleMouseUp(e){this.removeMouseMoveEventListeners(),this.isMouseDelayMet=!1,this.mouseDownInfo=null,this.isMouseStarted&&(this.isMouseStarted=!1,this.mouseStop(e))}removeMouseMoveEventListeners(){document.removeEventListener("mousemove",this.mouseMove,{passive:!1}),document.removeEventListener("touchmove",this.touchMove,{passive:!1}),document.removeEventListener("mouseup",this.mouseUp,{passive:!1}),document.removeEventListener("touchend",this.touchEnd,{passive:!1})}touchStart=e=>{if(!e)return;if(e.touches.length>1)return;const t=e.changedTouches[0];t&&this.handleMouseDown(v(t,e))};touchMove=e=>{if(!e)return;if(e.touches.length>1)return;const t=e.changedTouches[0];t&&this.handleMouseMove(e,v(t,e))};touchEnd=e=>{if(!e)return;if(e.touches.length>1)return;const t=e.changedTouches[0];t&&this.handleMouseUp(v(t,e))}}class S{constructor(e){this.treeWidget=e}saveState(){const e=JSON.stringify(this.getState());this.treeWidget.options.onSetStateFromStorage?this.treeWidget.options.onSetStateFromStorage(e):this.supportsLocalStorage()&&localStorage.setItem(this.getKeyName(),e)}getStateFromStorage(){const e=this.loadFromStorage();return e?this.parseState(e):null}getState(){return{open_nodes:(()=>{const e=[];return this.treeWidget.tree.iterate((t=>(t.is_open&&t.id&&t.hasChildren()&&e.push(t.id),!0))),e})(),selected_node:(()=>{const e=[];return this.treeWidget.getSelectedNodes().forEach((t=>{null!=t.id&&e.push(t.id)})),e})()}}setInitialState(e){if(e){let t=!1;return e.open_nodes&&(t=this.openInitialNodes(e.open_nodes)),e.selected_node&&(this.resetSelection(),this.selectInitialNodes(e.selected_node)),t}return!1}setInitialStateOnDemand(e,t){e?this.doSetInitialStateOnDemand(e.open_nodes,e.selected_node,t):t()}getNodeIdToBeSelected(){const e=this.getStateFromStorage();return e&&e.selected_node&&e.selected_node[0]||null}parseState(e){const t=JSON.parse(e);var s;return t&&t.selected_node&&("number"==typeof(s=t.selected_node)&&s%1==0)&&(t.selected_node=[t.selected_node]),t}loadFromStorage(){return this.treeWidget.options.onGetStateFromStorage?this.treeWidget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getKeyName()):null}openInitialNodes(e){let t=!1;for(const s of e){const e=this.treeWidget.getNodeById(s);e&&(e.load_on_demand?t=!0:e.is_open=!0)}return t}selectInitialNodes(e){let t=0;for(const s of e){const e=this.treeWidget.getNodeById(s);e&&(t+=1,this.treeWidget.selectNodeHandler.addToSelection(e))}return 0!==t}resetSelection(){const e=this.treeWidget.selectNodeHandler;e.getSelectedNodes().forEach((t=>{e.removeFromSelection(t)}))}doSetInitialStateOnDemand(e,t,s){let o=0,i=e;const n=()=>{const e=[];for(const t of i){const s=this.treeWidget.getNodeById(t);s?s.is_loading||(s.load_on_demand?r(s):this.treeWidget._openNode(s,!1,null)):e.push(t)}i=e,this.selectInitialNodes(t)&&this.treeWidget._refreshElements(null),0===o&&s()},r=e=>{o+=1,this.treeWidget._openNode(e,!1,(()=>{o-=1,n()}))};n()}getKeyName(){return"string"==typeof this.treeWidget.options.saveState?this.treeWidget.options.saveState:"tree"}supportsLocalStorage(){return null==this._supportsLocalStorage&&(this._supportsLocalStorage=(()=>{if(null==localStorage)return!1;try{const e="_storage_test";sessionStorage.setItem(e,"value"),sessionStorage.removeItem(e)}catch(e){return!1}return!0})()),this._supportsLocalStorage}}class y{constructor(e){this.treeWidget=e,this.previousTop=-1,this.isInitialized=!1}checkScrolling(){this.ensureInit(),this.checkVerticalScrolling(),this.checkHorizontalScrolling()}scrollToY(e){if(this.ensureInit(),this.$scrollParent&&this.$scrollParent[0])this.$scrollParent[0].scrollTop=e;else{const t=this.treeWidget.$el.offset(),s=t?t.top:0;jQuery(document).scrollTop(e+s)}}isScrolledIntoView(e){let t,s,o,i;this.ensureInit();const n=e.height()||0;if(this.$scrollParent){i=0,s=this.$scrollParent.height()||0;const r=e.offset();o=(r?r.top:0)-this.scrollParentTop,t=o+n}else{i=jQuery(window).scrollTop()||0;s=i+(jQuery(window).height()||0);const r=e.offset();o=r?r.top:0,t=o+n}return t<=s&&o>=i}getScrollLeft(){return this.$scrollParent&&this.$scrollParent.scrollLeft()||0}initScrollParent(){const e=()=>{this.scrollParentTop=0,this.$scrollParent=null};"fixed"===this.treeWidget.$el.css("position")&&e();const t=(()=>{const e=["overflow","overflow-y"],t=t=>{for(const s of e){const e=t.css(s);if("auto"===e||"scroll"===e)return!0}return!1};if(t(this.treeWidget.$el))return this.treeWidget.$el;for(const e of this.treeWidget.$el.parents().get()){const s=jQuery(e);if(t(s))return s}return null})();if(t&&t.length&&"HTML"!==t[0]?.tagName){this.$scrollParent=t;const e=this.$scrollParent.offset();this.scrollParentTop=e?e.top:0}else e();this.isInitialized=!0}ensureInit(){this.isInitialized||this.initScrollParent()}handleVerticalScrollingWithScrollParent(e){const t=this.$scrollParent&&this.$scrollParent[0];if(!t)return;this.scrollParentTop+t.offsetHeight-e.bottom<20?(t.scrollTop+=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1):e.top-this.scrollParentTop<20&&(t.scrollTop-=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1)}handleVerticalScrollingWithDocument(e){const t=jQuery(document).scrollTop()||0;if(e.top-t<20)jQuery(document).scrollTop(t-20);else{(jQuery(window).height()||0)-(e.bottom-t)<20&&jQuery(document).scrollTop(t+20)}}checkVerticalScrolling(){const e=this.treeWidget.dndHandler.hoveredArea;e&&e.top!==this.previousTop&&(this.previousTop=e.top,this.$scrollParent?this.handleVerticalScrollingWithScrollParent(e):this.handleVerticalScrollingWithDocument(e))}checkHorizontalScrolling(){const e=this.treeWidget.dndHandler.positionInfo;e&&(this.$scrollParent?this.handleHorizontalScrollingWithParent(e):this.handleHorizontalScrollingWithDocument(e))}handleHorizontalScrollingWithParent(e){if(void 0===e.pageX||void 0===e.pageY)return;const t=this.$scrollParent,s=t&&t.offset();if(!t||!s)return;const o=t[0];if(!o)return;const i=o.scrollLeft+o.clientWidth<o.scrollWidth,n=o.scrollLeft>0,r=s.left+o.clientWidth,l=s.left,d=e.pageX>r-20,a=e.pageX<l+20;d&&i?o.scrollLeft=Math.min(o.scrollLeft+20,o.scrollWidth):a&&n&&(o.scrollLeft=Math.max(o.scrollLeft-20,0))}handleHorizontalScrollingWithDocument(e){if(void 0===e.pageX||void 0===e.pageY)return;const t=jQuery(document),s=t.scrollLeft()||0,o=jQuery(window).width()||0,i=s>0,n=e.pageX>o-20,r=e.pageX-s<20;n?t.scrollLeft(s+20):r&&i&&t.scrollLeft(Math.max(s-20,0))}}class D{constructor(e){this.treeWidget=e,this.selectedNodes=new Set,this.clear()}getSelectedNode(){const e=this.getSelectedNodes();return e.length&&e[0]||!1}getSelectedNodes(){if(this.selectedSingleNode)return[this.selectedSingleNode];{const e=[];return this.selectedNodes.forEach((t=>{const s=this.treeWidget.getNodeById(t);s&&e.push(s)})),e}}getSelectedNodesUnder(e){if(this.selectedSingleNode)return e.isParentOf(this.selectedSingleNode)?[this.selectedSingleNode]:[];{const t=[];for(const s in this.selectedNodes)if(Object.prototype.hasOwnProperty.call(this.selectedNodes,s)){const o=this.treeWidget.getNodeById(s);o&&e.isParentOf(o)&&t.push(o)}return t}}isNodeSelected(e){return null!=e.id?this.selectedNodes.has(e.id):!!this.selectedSingleNode&&this.selectedSingleNode.element===e.element}clear(){this.selectedNodes.clear(),this.selectedSingleNode=null}removeFromSelection(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==e.id?this.selectedSingleNode&&e.element===this.selectedSingleNode.element&&(this.selectedSingleNode=null):(this.selectedNodes.delete(e.id),t&&e.iterate((()=>(null!=e.id&&this.selectedNodes.delete(e.id),!0))))}addToSelection(e){null!=e.id?this.selectedNodes.add(e.id):this.selectedSingleNode=e}isFocusOnTree(){const e=document.activeElement;return Boolean(e&&"SPAN"===e.tagName&&this.treeWidget._containsElement(e))}}class _{constructor(e,t){this.init(e,t)}init(e,t){if(this.node=e,this.treeWidget=t,!e.element){const t=this.treeWidget.element.get(0);t&&(e.element=t)}e.element&&(this.$element=jQuery(e.element))}addDropHint(e){return this.mustShowBorderDropHint(e)?new C(this.$element,this.treeWidget._getScrollLeft()):new E(this.node,this.$element,e)}select(e){this.getLi().addClass("jqtree-selected");const t=this.getSpan();t.attr("tabindex",this.treeWidget.options.tabIndex??null),t.attr("aria-selected","true"),e&&t.trigger("focus")}deselect(){this.getLi().removeClass("jqtree-selected");const e=this.getSpan();e.removeAttr("tabindex"),e.attr("aria-selected","false"),e.trigger("blur")}getUl(){return this.$element.children("ul:first")}getSpan(){return this.$element.children(".jqtree-element").find("span.jqtree-title")}getLi(){return this.$element}mustShowBorderDropHint(e){return e===t.Inside}}class I extends _{open(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fast";if(this.node.is_open)return;this.node.is_open=!0;const o=this.getButton();o.removeClass("jqtree-closed"),o.html("");const i=o.get(0);if(i){const e=this.treeWidget.renderer.openedIconElement;if(e){const t=e.cloneNode(!0);i.appendChild(t)}}const n=()=>{this.getLi().removeClass("jqtree-closed");this.getSpan().attr("aria-expanded","true"),e&&e(this.node),this.treeWidget._triggerEvent("tree.open",{node:this.node})};t?this.getUl().slideDown(s,n):(this.getUl().show(),n())}close(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fast";if(!this.node.is_open)return;this.node.is_open=!1;const s=this.getButton();s.addClass("jqtree-closed"),s.html("");const o=s.get(0);if(o){const e=this.treeWidget.renderer.closedIconElement;if(e){const t=e.cloneNode(!0);o.appendChild(t)}}const i=()=>{this.getLi().addClass("jqtree-closed");this.getSpan().attr("aria-expanded","false"),this.treeWidget._triggerEvent("tree.close",{node:this.node})};e?this.getUl().slideUp(t,i):(this.getUl().hide(),i())}mustShowBorderDropHint(e){return!this.node.is_open&&e===t.Inside}getButton(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")}}class C{constructor(e,t){const s=e.children(".jqtree-element"),o=e.width()||0,i=Math.max(o+t-4,0),n=s.outerHeight()||0,r=Math.max(n-4,0);this.$hint=jQuery('<span class="jqtree-border"></span>'),s.append(this.$hint),this.$hint.css({width:i,height:r})}remove(){this.$hint.remove()}}class E{constructor(e,s,o){this.$element=s,this.node=e,this.$ghost=jQuery('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span>\n            <span class="jqtree_common jqtree-line"></span></li>'),o===t.After?this.moveAfter():o===t.Before?this.moveBefore():o===t.Inside&&(e.isFolder()&&e.is_open?this.moveInsideOpenFolder():this.moveInside())}remove(){this.$ghost.remove()}moveAfter(){this.$element.after(this.$ghost)}moveBefore(){this.$element.before(this.$ghost)}moveInsideOpenFolder(){const e=this.node.children[0]?.element;e&&jQuery(e).before(this.$ghost)}moveInside(){this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")}}const F="Node parameter is empty",j="Parameter is empty: ";class W extends N{static defaults={animationSpeed:"fast",autoEscape:!0,autoOpen:!1,buttonLeft:!0,closedIcon:void 0,data:void 0,dataFilter:void 0,dataUrl:void 0,dragAndDrop:!1,keyboardSupport:!0,nodeClass:n,onCanMove:void 0,onCanMoveTo:void 0,onCanSelectNode:void 0,onCreateLi:void 0,onDragMove:void 0,onDragStop:void 0,onGetStateFromStorage:void 0,onIsMoveHandle:void 0,onLoadFailed:void 0,onLoading:void 0,onSetStateFromStorage:void 0,openedIcon:"&#x25bc;",openFolderDelay:500,rtl:void 0,saveState:!1,selectable:!0,showEmptyFolder:!1,slide:!0,startDndDelay:300,tabIndex:0,useContextMenu:!0};toggle(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw Error(F);const s=t??this.options.slide;return e.is_open?this.closeNode(e,s):this.openNode(e,s),this.element}getTree(){return this.tree}selectNode(e,t){return this.doSelectNode(e,t),this.element}getSelectedNode(){return this.selectNodeHandler.getSelectedNode()}toJson(){return JSON.stringify(this.tree.getData())}loadData(e,t){return this.doLoadData(e,t),this.element}loadDataFromUrl(e,t,s){return"string"==typeof e?this.doLoadDataFromUrl(e,t,s??null):this.doLoadDataFromUrl(null,e,t),this.element}reload(e){return this.doLoadDataFromUrl(null,null,e),this.element}refresh(){return this._refreshElements(null),this.element}getNodeById(e){return this.tree.getNodeById(e)}getNodeByName(e){return this.tree.getNodeByName(e)}getNodeByNameMustExist(e){return this.tree.getNodeByNameMustExist(e)}getNodesByProperty(e,t){return this.tree.getNodesByProperty(e,t)}getNodeByHtmlElement(e){return this.getNode(jQuery(e))}getNodeByCallback(e){return this.tree.getNodeByCallback(e)}openNode(e,t,s){if(!e)throw Error(F);const[o,i]=(()=>{let e,o;return"function"==typeof t?(e=t,o=null):(o=t,e=s),null==o&&(o=this.options.slide??!1),[o,e]})();return this._openNode(e,o,i),this.element}closeNode(e,t){if(!e)throw Error(F);const s=t??this.options.slide;return(e.isFolder()||e.isEmptyFolder)&&(new I(e,this).close(s,this.options.animationSpeed),this.saveState()),this.element}isDragging(){return this.dndHandler.isDragging}refreshHitAreas(){return this.dndHandler.refresh(),this.element}addNodeAfter(e,t){const s=t.addAfter(e);return s&&this._refreshElements(t.parent),s}addNodeBefore(e,t){if(!t)throw Error(j+"existingNode");const s=t.addBefore(e);return s&&this._refreshElements(t.parent),s}addParentNode(e,t){if(!t)throw Error(j+"existingNode");const s=t.addParent(e);return s&&this._refreshElements(s.parent),s}removeNode(e){if(!e)throw Error(F);if(!e.parent)throw Error("Node has no parent");this.selectNodeHandler.removeFromSelection(e,!0);const t=e.parent;return e.remove(),this._refreshElements(t),this.element}appendNode(e,t){const s=t||this.tree,o=s.append(e);return this._refreshElements(s),o}prependNode(e,t){const s=t??this.tree,o=s.prepend(e);return this._refreshElements(s),o}updateNode(e,t){if(!e)throw Error(F);const s="object"==typeof t&&t.id&&t.id!==e.id;return s&&this.tree.removeNodeFromIndex(e),e.setData(t),s&&this.tree.addNodeToIndex(e),"object"==typeof t&&t.children&&t.children instanceof Array&&(e.removeChildren(),t.children.length&&e.loadFromData(t.children)),this._refreshElements(e),this.element}isSelectedNodeInSubtree(e){const t=this.getSelectedNode();return!!t&&(e===t||e.isParentOf(t))}moveNode(e,t,o){if(!e)throw Error(F);if(!t)throw Error(j+"targetNode");const i=s[o];return void 0!==i&&(this.tree.moveNode(e,t,i),this._refreshElements(null)),this.element}getStateFromStorage(){return this.saveStateHandler.getStateFromStorage()}addToSelection(e,t){if(!e)throw Error(F);return this.selectNodeHandler.addToSelection(e),this._getNodeElementForNode(e).select(void 0===t||t),this.saveState(),this.element}getSelectedNodes(){return this.selectNodeHandler.getSelectedNodes()}isNodeSelected(e){if(!e)throw Error(F);return this.selectNodeHandler.isNodeSelected(e)}removeFromSelection(e){if(!e)throw Error(F);return this.selectNodeHandler.removeFromSelection(e),this._getNodeElementForNode(e).deselect(),this.saveState(),this.element}scrollToNode(e){if(!e)throw Error(F);const t=jQuery(e.element).offset(),s=t?t.top:0,o=this.$el.offset(),i=s-(o?o.top:0);return this.scrollHandler.scrollToY(i),this.element}getState(){return this.saveStateHandler.getState()}setState(e){return this.saveStateHandler.setInitialState(e),this._refreshElements(null),this.element}setOption(e,t){return this.options[e]=t,this.element}moveDown(){const e=this.getSelectedNode();return e&&this.keyHandler.moveDown(e),this.element}moveUp(){const e=this.getSelectedNode();return e&&this.keyHandler.moveUp(e),this.element}getVersion(){return"1.7.4"}_triggerEvent(e,t){const s=jQuery.Event(e,t);return this.element.trigger(s),s}_openNode(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;const o=(e,t,s)=>{new I(e,this).open(s,t,this.options.animationSpeed)};if(e.isFolder()||e.isEmptyFolder)if(e.load_on_demand)this.loadFolderOnDemand(e,t,s);else{let i=e.parent;for(;i;)i.parent&&o(i,!1,null),i=i.parent;o(e,t,s),this.saveState()}}_refreshElements(e){const t=this.selectNodeHandler.isFocusOnTree(),s=!!e&&this.isSelectedNodeInSubtree(e);this.renderer.render(e),s&&this.selectCurrentNode(t),this._triggerEvent("tree.refresh")}_getNodeElementForNode(e){return e.isFolder()?new I(e,this):new _(e,this)}_getNodeElement(e){const t=this.getNode(e);return t?this._getNodeElementForNode(t):null}_containsElement(e){const t=this.getNode(jQuery(e));return null!=t&&t.tree===this.tree}_getScrollLeft(){return this.scrollHandler.getScrollLeft()}init(){super.init(),this.element=this.$el,this.isInitialized=!1,this.options.rtl=this.getRtlOption(),null==this.options.closedIcon&&(this.options.closedIcon=this.getDefaultClosedIcon()),this.renderer=new c(this),this.dataLoader=new u(this),this.saveStateHandler=new S(this),this.selectNodeHandler=new D(this),this.dndHandler=new r(this),this.scrollHandler=new y(this),this.keyHandler=new g(this),this.initData(),this.element.on("click",this.handleClick),this.element.on("dblclick",this.handleDblclick),this.options.useContextMenu&&this.element.on("contextmenu",this.handleContextmenu)}deinit(){this.element.empty(),this.element.off(),this.keyHandler.deinit(),this.tree=new n({},!0),super.deinit()}mouseCapture(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseCapture(e)}mouseStart(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStart(e)}mouseDrag(e){if(this.options.dragAndDrop){const t=this.dndHandler.mouseDrag(e);return this.scrollHandler.checkScrolling(),t}return!1}mouseStop(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStop(e)}getMouseDelay(){return this.options.startDndDelay??0}initData(){if(this.options.data)this.doLoadData(this.options.data,null);else{this.getDataUrlInfo(null)?this.doLoadDataFromUrl(null,null,null):this.doLoadData([],null)}}getDataUrlInfo(e){const t=this.options.dataUrl||this.element.data("url"),s=t=>{if(e?.id){const s={node:e.id};t.data=s}else{const e=this.getNodeIdToBeSelected();if(e){const s={selected_node:e};t.data=s}}};return"function"==typeof t?t(e):"string"==typeof t?(e=>{const t={url:e};return s(t),t})(t):t&&"object"==typeof t?(s(t),t):null}getNodeIdToBeSelected(){return this.options.saveState?this.saveStateHandler.getNodeIdToBeSelected():null}initTree(e){const t=()=>{this.isInitialized||(this.isInitialized=!0,this._triggerEvent("tree.init"))};if(!this.options.nodeClass)return;this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.selectNodeHandler.clear(),this.tree.loadFromData(e);const s=this.setInitialState();this._refreshElements(null),s?this.setInitialStateOnDemand(t):t()}setInitialState(){const e=()=>{if(!1===this.options.autoOpen)return!1;const e=this.getAutoOpenMaxLevel();let t=!1;return this.tree.iterate(((s,o)=>s.load_on_demand?(t=!0,!1):!!s.hasChildren()&&(s.is_open=!0,o!==e))),t};let[t,s]=(()=>{if(this.options.saveState){const e=this.saveStateHandler.getStateFromStorage();if(e){return[!0,this.saveStateHandler.setInitialState(e)]}return[!1,!1]}return[!1,!1]})();return t||(s=e()),s}setInitialStateOnDemand(e){const t=()=>{const t=this.getAutoOpenMaxLevel();let s=0;const o=e=>{s+=1,this._openNode(e,!1,(()=>{s-=1,i()}))},i=()=>{this.tree.iterate(((e,s)=>e.load_on_demand?(e.is_loading||o(e),!1):(this._openNode(e,!1,null),s!==t))),0===s&&e()};i()};(()=>{if(this.options.saveState){const t=this.saveStateHandler.getStateFromStorage();return!!t&&(this.saveStateHandler.setInitialStateOnDemand(t,e),!0)}return!1})()||t()}getAutoOpenMaxLevel(){return!0===this.options.autoOpen?-1:"number"==typeof this.options.autoOpen?this.options.autoOpen:"string"==typeof this.options.autoOpen?parseInt(this.options.autoOpen,10):0}handleClick=e=>{const t=this.getClickTarget(e.target);if(t)if("button"===t.type)this.toggle(t.node,this.options.slide),e.preventDefault(),e.stopPropagation();else if("label"===t.type){const s=t.node;this._triggerEvent("tree.click",{node:s,click_event:e}).isDefaultPrevented()||this.doSelectNode(s)}};handleDblclick=e=>{const t=this.getClickTarget(e.target);"label"===t?.type&&this._triggerEvent("tree.dblclick",{node:t.node,click_event:e})};getClickTarget(e){const t=jQuery(e),s=t.closest(".jqtree-toggler");if(s.length){const e=this.getNode(s);if(e)return{type:"button",node:e}}else{const e=t.closest(".jqtree-element");if(e.length){const t=this.getNode(e);if(t)return{type:"label",node:t}}}return null}getNode(e){const t=e.closest("li.jqtree_common");return 0===t.length?null:t.data("node")}handleContextmenu=e=>{const t=jQuery(e.target).closest("ul.jqtree-tree .jqtree-element");if(t.length){const s=this.getNode(t);if(s)return e.preventDefault(),e.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:s,click_event:e}),!1}return null};saveState(){this.options.saveState&&this.saveStateHandler.saveState()}selectCurrentNode(e){const t=this.getSelectedNode();if(t){const s=this._getNodeElementForNode(t);s&&s.select(e)}}deselectCurrentNode(){const e=this.getSelectedNode();e&&this.removeFromSelection(e)}getDefaultClosedIcon(){return this.options.rtl?"&#x25c0;":"&#x25ba;"}getRtlOption(){if(null!=this.options.rtl)return this.options.rtl;{const e=this.element.data("rtl");return null!==e&&!1!==e&&void 0!==e}}doSelectNode(e,t){const s=()=>{this.options.saveState&&this.saveStateHandler.saveState()};if(!e)return this.deselectCurrentNode(),void s();const o={mustSetFocus:!0,mustToggle:!0,...t||{}},i=()=>{const t=e.parent;t&&t.parent&&!t.is_open&&this.openNode(t,!1)};if((()=>this.options.onCanSelectNode?!0===this.options.selectable&&this.options.onCanSelectNode(e):!0===this.options.selectable)()){if(this.selectNodeHandler.isNodeSelected(e))o.mustToggle&&(this.deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:e}));else{const t=this.getSelectedNode()||null;this.deselectCurrentNode(),this.addToSelection(e,o.mustSetFocus),this._triggerEvent("tree.select",{node:e,deselected_node:t}),i()}s()}}doLoadData(e,t){e&&(t?(this.deselectNodes(t),this.loadSubtree(e,t)):this.initTree(e),this.isDragging()&&this.dndHandler.refresh()),this._triggerEvent("tree.load_data",{tree_data:e,parent_node:t})}deselectNodes(e){const t=this.selectNodeHandler.getSelectedNodesUnder(e);for(const e of t)this.selectNodeHandler.removeFromSelection(e)}loadSubtree(e,t){t.loadFromData(e),t.load_on_demand=!1,t.is_loading=!1,this._refreshElements(t)}doLoadDataFromUrl(e,t,s){const o=e||this.getDataUrlInfo(t);this.dataLoader.loadFromUrl(o,t,s)}loadFolderOnDemand(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;e.is_loading=!0,this.doLoadDataFromUrl(null,e,(()=>{this._openNode(e,t,s)}))}}return m.register(W,"tree"),e.JqTreeWidget=W,e}({});
//# sourceMappingURL=tree.jquery.js.map
